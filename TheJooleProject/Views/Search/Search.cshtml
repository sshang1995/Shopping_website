
@{
    ViewBag.Title = "Search";
}

@model TheJooleProject.DAL.SearchViewModel
@*<h2>Search</h2>*@

@*<div class="category">


    </div>*@
@Styles.Render("~/Content/TheJooleProject/Search")
<div class="d-inline-flex p-2">

    <div class="container d-flex h-100">

        <div class="row justify-content-center align-self-center">



            <div class="btn-group">


                <button class="btn btn-secondary dropdown-toggle" type="button" id="categoryMenuBtn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Category
                </button>
                <div class="dropdown-menu" aria-labelledby="categoryMenuBtn" id="categoriesDropDown">
                    @*<a class="dropdown-item" href="#" data-selected="true" hidden> All </a>*@
                    @{


                        foreach (var item in Model.c)
                        {
                            <a class="dropdown-item" href="#" data-selected="false" value="@item.CategoryName">@item.CategoryName</a>
                        }
                    }
                </div>


            </div>
            <div class="btn-group">


                @*

                    <input type="text" id="subCategoriesInput" name="scInput" list="scInputList">
                    <datalist id="scInputList">
                        <option value="">

                            </datalist>
                        <input type="button" name="button" value="Search" src="~/Images/bundle-icon-search-blue-search-button.jpg" class="imgBtnSearch" />


                *@

                <form class="form-inline my-2 my-lg-0" id="search">
                    <input name="SubCategory" list="subCategories" class="form-control mr-sm-2" type="text" aria-label="Search" id="searchInput">

                    <datalist id="subCategories">
                        @{
                            foreach (var val in Model.t)
                            {
                                <option value="@val.c2.SubCategory_Name" class="@val.c1.CategoryName" data-id="@val.c2.SubCategoryID"></option>
                            }
                        }
                    </datalist>

                    <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
                </form>
            </div>
        </div>



    </div>


</div>


@*<input type="button" name="button" value="Search" onclick="showUser()" class="button" />*@


<script>
    // var subCategoryList = @Model.
    // var subCategory = $("a[data-selected='true']").next().attr("value");
    $(document).ready(function () {

        var disableAllSubCatOptions = function () {
            $("#subCategories").children("option").each(function () { $(this).prop("disabled", true) });

        }
        // disableAllSubCatOptions();

        $("#categoriesDropDown").on("click", "a", function (event) {
            disableAllSubCatOptions();
            // while($("#subCategories option"))
            let c = $(event.target).attr("value");
            $(`.${c}`).prop("disabled", false);
        });

        $("#searchInput").on('input', function () {
            var val = this.value;
            if ($('#subCategories option').filter(function () {
                return this.value.toUpperCase() === val.toUpperCase();
            }).length) {
                var id = $(`option[value='${val}']`).attr("data-id");
                $(this).attr("data-SubCategoryID", id);
            }
        });


        $("#search").submit(function (event) {
            console.log($("#searchInput").val());
            console.log($("#search").serializeArray());
            $(this).attr("method", "POST");
            $(this).attr("action", "https://" + window.location.host + "/Search/ProductSummary");
            var sid_val = $("#searchInput").attr("data-SubCategoryID");
            var sid = $(this).find("#SubCategoryID");

            if (sid.length != 0) {
                sid.remove();
            }
            $(this).append(`<input name='SubCategoryID' id='SubCategoryID' value='${sid_val}' />`);
            console.log($(this).attr("action"));
            // event.preventDefault();
        });

    });


</script>